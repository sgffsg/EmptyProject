# Отношения между классами

## Визуализация архитектуры
- Классы программы создаются и взаимодействуют по определённым правилам
- Знание этих правил позволяет создавать программу не методом проб и ошибок, а проектировать её ещё до написания кода
- Можно обсудить архитектуру и распределить работу над программы между программистами
- Можно распределить работу над различными частями программы

## Диаграмма классов
- Один из способов визуализации структуры программы
- Показывает классы и интерфейсы, их состав и связи между ними
- UML – универсальный язык моделирования

## Ассоциация
- Отношение, при котором один класс знает о другом, но может существовать отдельно от него
- Возможно наличие двусторонней ассоциации
- Пример:
  - `Учитель <-> Ученик`
- Реализуется за счёт хранения ссылки или указателя на ассоциированный объект

## Композиция
- Отношение, при котором один объект является Частью другого, составного объекта
- Часть в один момент времени принадлежит только одному составному объекту
- Составной объект управляет своими частями.
  - Часть удаляется при удалении объекта
- Часть обычно не знает о том, в состав каких объектов она входит
- В C++ классы обычно используют композицию
  - Один класс выступает в роли поля другого

Примеры
- Точка на плоскости
  - Пара чисел, задающих координаты точки
- Окружность
  - Точка (центр) и число (радиус)
- Класс комплексных чисел
  - Действительная и мнимая часть
- Класс рациональных чисел
  - Пара целых чисел - числитель и знаменатель
- Многоугольник
  - Координаты вершин

```c++
// Книга - пример композиции экземпляров string и int.
class Book
{
  ... 
private: 
  string m_title;
  string m_author;
  string m_isbn; // ISBN - уникальный номер книжного издания
  int m_publicationYear; // Год публикации
};
 
// Человек - ещё один пример композиции экземпляров string и int
class Person
{
private:
  string m_name;
  string m_address;
  int m_birthYear;
};
```

## Агрегация
- Отношение вида «Часть – Целое»
- Часть является частью Целого
- Часть в один и тот же момент может принадлежать нескольким составным объектам
- Целое не управляет своими частями
  - При удалении Целого Часть продолжает существовать
- Часть не знает о существовании Целого
- Транзитивность
  - Ни один из объектов не является прямой или косвенной частью себя
- Класс-агрегат хранит ссылки или указатели на объекты, созданные за пределами класса

Пример
```c++
class TV {
  …
};


class RemoteControl {
public:
  RemoteControl(TVSet & tv, std::istream& input, std::ostream& output);
  …
private:

  TVSet& m_tv;
  std::istream& m_input;
  std::ostream& m_output;
};
```

### Зависимость (Dependency)

Особенности:
- Отношение «Клиент – Поставщик», при котором изменения в Поставщике могут вызвать изменения в Клиенте (но не наоборот)
- Возникает в следующих случаях:
  - Поставщик создаётся внутри метода Клиента
  - Поставщик передаётся в метод Клиента, который вызывает его методы
  - Метод Клиента возвращает Поставщика
- Поставщик ничего не знает про Клиента
- Зависимость создаёт кратковременную связь между объектами (на время вызова метода)

```c++
class Supplier
{
public:
  void DoSomething();
};

class Client
{
public:
  void DependentMethod1(Supplier& supplier) { supplier.DoSomething(); }
  void DependentMethod2()
  {
    Supplier supplier;
    supplier.DoSomething();
  }
  Supplier DependentMethod3() { return Supplier{}; }
  void IndependentMethod()
  {
    cout << "Hello"s << endl;
  }
};
```

```c++
class Document
{
public:
  // output используется только для записи документа
  void SaveToStream(ostream& output) const {
    output << m_title << std::endl << m_text << std::endl;
  }

  // input используется только для чтения документа
  void LoadFromStream(istream& input) {
    std::getline(input, m_title);

    m_text.clear();
    std::string line;
    while (std::getline(input, line)) {
      if (m_text.empty()) {
        m_text += '\n';
      }
      m_text += line;
    }
  }

private:
  std::string m_title;
  std::string m_text;
};
```

## Итоги

### Композиция
- При композиции Целое единолично владеет содержащейся в нём Частью
- Как правило, Целое не отдаёт наружу ссылки на свои Части
- Композиция обозначается стрелкой с закрашенным ромбиком.

### Агрегация
- При агрегации Целое пользуется Частью совместно с другими объектами и не владеет им единолично
- Состояние Части может измениться из-за обращения к ней других объектов
- Агрегация обозначается стрелкой с незакрашенным ромбиком.

### Различие между композицией и агрегацией
- При композиции время жизни Части ограничено временем жизни Целого
- При агрегации Часть и Целое живут независимо

### Зависимость
- Зависимость задаёт отношение вида «‎Клиент-Поставщик»‎.
- Клиент использует переданного ему Поставщика, но не сохраняет ссылку на него в своих полях
  - Либо создаёт  
- Зависимость обозначается пунктирной стрелкой.
